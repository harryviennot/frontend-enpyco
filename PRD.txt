# PRD Frontend - Application de G√©n√©ration de M√©moires Techniques

## 1. Vue d'ensemble

### Objectif
Cr√©er une interface utilisateur intuitive permettant aux conducteurs de travaux de g√©n√©rer automatiquement des m√©moires techniques personnalis√©s en r√©utilisant intelligemment le contenu d'anciens m√©moires.

### Stack technique
- **Framework**: Next.js 14 (App Router)
- **UI**: Tailwind CSS + shadcn/ui
- **√âtat**: React Query (TanStack Query)
- **Formulaires**: React Hook Form + Zod
- **Upload**: react-dropzone
- **Preview**: react-pdf, docx-preview
- **Diff**: react-diff-viewer-continued

---

## 2. Architecture Frontend

### Structure des dossiers
```
src/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ (auth)/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ register/
‚îÇ   ‚îú‚îÄ‚îÄ (dashboard)/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ projects/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ library/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ settings/
‚îÇ   ‚îî‚îÄ‚îÄ layout.tsx
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ ui/              # shadcn components
‚îÇ   ‚îú‚îÄ‚îÄ projects/
‚îÇ   ‚îú‚îÄ‚îÄ library/
‚îÇ   ‚îú‚îÄ‚îÄ editor/
‚îÇ   ‚îî‚îÄ‚îÄ common/
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ api/            # API client
‚îÇ   ‚îú‚îÄ‚îÄ hooks/          # Custom hooks
‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îî‚îÄ‚îÄ types/
‚îî‚îÄ‚îÄ styles/
```

---

## 3. Pages & Fonctionnalit√©s

### 3.1 Dashboard Principal (`/dashboard`)

**Composants cl√©s:**
- `ProjectsOverview`: Grille de projets avec filtres
- `QuickStats`: KPIs (projets actifs, m√©moires g√©n√©r√©s, taux de succ√®s)
- `RecentActivity`: Timeline des derni√®res actions

**Fonctionnalit√©s:**
- Cr√©er un nouveau projet (CTA pro√©minent)
- Recherche/filtrage des projets (par statut, date, client)
- Tri personnalisable
- Vue grille/liste

**√âtats:**
```typescript
interface Project {
  id: string
  name: string
  client?: string
  status: 'DRAFT' | 'GENERATING' | 'READY' | 'FINAL' | 'ARCHIVED'
  progress: number // 0-100
  createdAt: Date
  updatedAt: Date
}
```

---

### 3.2 Cr√©ation de Projet (`/projects/new`)

#### √âtape 1: Informations de base
**Composant:** `ProjectBasicInfo`
```typescript
interface ProjectForm {
  name: string
  client?: string
  description?: string
}
```

**Validation:**
- Nom requis (min 3 caract√®res)
- Client optionnel
- Description optionnelle (max 500 caract√®res)

#### √âtape 2: Upload du RC
**Composant:** `RCUploader`
```typescript
interface RCUpload {
  file: File // PDF uniquement
  status: 'idle' | 'uploading' | 'parsing' | 'done' | 'error'
  extractedCriteria?: string[]
}
```

**Fonctionnalit√©s:**
- Drag & drop ou clic pour upload
- Validation format (PDF uniquement)
- Limite taille (50MB)
- Barre de progression
- Preview du RC upload√©
- Affichage des crit√®res extraits (auto ou manuel)

#### √âtape 3: S√©lection des m√©moires r√©f√©rence
**Composant:** `MemoireSelector`

**Features:**
- Auto-suggestion par similarit√© (bas√©e sur RC)
- Liste de tous les m√©moires disponibles
- Filtres: ann√©e, type de projet, client, montant
- Preview de chaque m√©moire au survol
- S√©lection multiple (checkboxes)
- Badge indiquant le score de similarit√©

```typescript
interface Memoire {
  id: string
  name: string
  client?: string
  year?: number
  projectType?: string
  similarityScore?: number // 0-100
  thumbnailUrl?: string
}
```

#### √âtape 4: Configuration des sections
**Composant:** `SectionsConfigurator`

**UI:**
- Liste de toutes les sections possibles
- Toggle ON/OFF pour chaque section
- Drag & drop pour r√©ordonner
- Upload d'images/documents sp√©cifiques par section

```typescript
interface SectionConfig {
  type: BlockType
  title: string
  enabled: boolean
  order: number
  customImages?: string[]
  customInstructions?: string
}
```

**Sections disponibles:**
1. ‚úÖ Pr√©sentation entreprise
2. ‚úÖ Organigramme groupe
3. ‚úÖ Hypoth√®ses de chiffrage
4. ‚úÖ Organisation du chantier
5. ‚úÖ M√©thodologie
6. ‚úÖ Moyens humains
7. ‚úÖ Moyens mat√©riels
8. ‚úÖ Planning
9. ‚úÖ Mat√©riaux et √©quipements
10. ‚úÖ Dispositions environnementales
11. ‚úÖ S√©curit√© et sant√©
12. ‚úÖ Insertion sociale
13. ‚úÖ R√©f√©rences

#### √âtape 5: G√©n√©ration
**Composant:** `GenerationProgress`

**UI:**
- Loader anim√©
- Message de progression par section
- Estimation du temps restant
- Option d'annulation
- Notification √† la fin

**√âtats:**
```typescript
interface GenerationStatus {
  currentSection: string
  completed: number
  total: number
  estimatedTimeRemaining: number // secondes
}
```

---

### 3.3 √âditeur de M√©moire (`/projects/[id]/edit`)

#### Layout
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Header: Nom projet | Statut | Actions     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ             ‚îÇ                               ‚îÇ
‚îÇ  Sidebar    ‚îÇ      Editor Area              ‚îÇ
‚îÇ  (Sections) ‚îÇ      (Content + Chat)         ‚îÇ
‚îÇ             ‚îÇ                               ‚îÇ
‚îÇ  - Section1 ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  - Section2 ‚îÇ  ‚îÇ  Preview Section        ‚îÇ  ‚îÇ
‚îÇ  - Section3 ‚îÇ  ‚îÇ  (Markdown rendered)    ‚îÇ  ‚îÇ
‚îÇ    ...      ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ             ‚îÇ                               ‚îÇ
‚îÇ             ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ             ‚îÇ  ‚îÇ  Chat contextuel        ‚îÇ  ‚îÇ
‚îÇ             ‚îÇ  ‚îÇ  "Rendre plus concis"   ‚îÇ  ‚îÇ
‚îÇ             ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ             ‚îÇ                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### Composants principaux

**1. `SectionsSidebar`**
- Liste cliquable des sections
- Indicateurs de statut (‚úì valid√©, ‚ö† √† revoir, üîÑ en cours)
- Navigation rapide
- Compte de mots par section

**2. `SectionEditor`**
```typescript
interface Section {
  id: string
  type: BlockType
  title: string
  content: string // Markdown
  images: string[]
  status: SectionStatus
  version: number
}
```

**Features:**
- Preview Markdown rendu
- Boutons d'action:
  - ‚úèÔ∏è √âditer (passe en mode texte)
  - üîÑ R√©g√©n√©rer
  - ‚úì Valider
  - üìã Dupliquer
- Affichage des images avec lightbox
- Metadata (tokens utilis√©s, temps de g√©n√©ration)

**3. `RegenerationChat`**
- Input pour instructions
- Exemples de prompts pr√©d√©finis:
  - "Rendre plus concis"
  - "Ajouter plus de d√©tails techniques"
  - "Adapter au ton formel"
  - "Mettre en avant l'aspect RSE"
- Loading state pendant r√©g√©n√©ration
- Preview avant/apr√®s (diff)

**4. `SectionDiff`**
- Comparaison version pr√©c√©dente vs nouvelle
- Highlighting des changements
- Boutons: Accepter / Rejeter / √âditer

---

### 3.4 Biblioth√®que de M√©moires (`/library`)

#### Vue d'ensemble
**Composant:** `MemoiresLibrary`

**Features:**
- Grille de cartes de m√©moires
- Filtres:
  - Type de projet
  - Ann√©e
  - Client
  - Montant
  - Statut d'indexation
- Recherche full-text
- Tri (date, nom, pertinence)

**Actions par m√©moire:**
- üëÅÔ∏è Preview
- üì• T√©l√©charger
- ‚úèÔ∏è √âditer m√©tadonn√©es
- üîç R√©indexer
- üóëÔ∏è Supprimer

#### Upload de nouveau m√©moire
**Composant:** `MemoireUploader`

**Formulaire:**
```typescript
interface MemoireUploadForm {
  file: File // PDF ou DOCX
  name: string
  client?: string
  year?: number
  projectType?: string
  location?: string
  montant?: number
  autoIndex: boolean // Indexer automatiquement
}
```

**Processus:**
1. Upload du fichier
2. Extraction m√©tadonn√©es automatique (si possible)
3. Validation/correction manuelle
4. Indexation (avec barre de progression)
5. Confirmation et ajout √† la biblioth√®que

---

### 3.5 Biblioth√®que de Blocs (`/library/blocks`)

**Composant:** `BlocksLibrary`

**Vue:**
- Grille de cartes par cat√©gorie
- Categories:
  - üìä Organigrammes
  - üì∏ Photos mat√©riel
  - üìÑ Textes types
  - üé® √âl√©ments graphiques

**Carte de bloc:**
```typescript
interface BlockCard {
  id: string
  type: BlockType
  title: string
  thumbnail?: string
  preview: string // Extrait du contenu
  tags: string[]
  usageCount: number // Nombre d'utilisations
}
```

**Actions:**
- Preview complet (modal)
- √âditer
- Dupliquer
- Supprimer
- Voir les usages (dans quels projets)

#### Cr√©ation/√âdition de bloc
**Composant:** `BlockEditor`

**Formulaire:**
- Type de bloc (dropdown)
- Titre
- Contenu (Markdown editor avec preview)
- Upload d'images
- Tags
- Cat√©gorie

---

### 3.6 Templates (`/templates`)

**Composant:** `TemplatesManager`

**Features:**
- Liste des templates Word disponibles
- Upload de nouveaux templates
- Preview des templates
- Marquer un template par d√©faut
- Gestion des versions

```typescript
interface DocumentTemplate {
  id: string
  name: string
  type: 'MEMOIRE_COMPLET' | 'SECTION' | 'PAGE_GARDE'
  thumbnailUrl?: string
  version: string
  isDefault: boolean
  downloadUrl: string
}
```

---

### 3.7 Export Final (`/projects/[id]/export`)

**Composant:** `ExportWizard`

#### Options d'export
```typescript
interface ExportOptions {
  format: 'docx' | 'pdf'
  includePageNumbers: boolean
  includeTOC: boolean // Table des mati√®res
  includeHeaders: boolean
  includeFooters: boolean
  customCoverPage?: boolean
}
```

**UI:**
- Formulaire avec options
- Preview du m√©moire final (rendu)
- Bouton "G√©n√©rer et t√©l√©charger"
- Loading state
- Lien de t√©l√©chargement direct
- Option "Enregistrer dans Google Drive"

---

## 4. Composants R√©utilisables

### 4.1 Upload de fichiers
**`FileUploader`**
```typescript
interface FileUploaderProps {
  accept: string[] // ['pdf', 'docx']
  maxSize: number // en MB
  multiple?: boolean
  onUpload: (files: File[]) => Promise<void>
  onError: (error: string) => void
}
```

**Features:**
- Drag & drop zone
- Clic pour s√©lectionner
- Validation format/taille
- Preview des fichiers
- Barre de progression
- Liste des fichiers upload√©s avec actions (supprimer, remplacer)

### 4.2 Markdown Editor
**`MarkdownEditor`**
```typescript
interface MarkdownEditorProps {
  value: string
  onChange: (value: string) => void
  placeholder?: string
  showPreview?: boolean
}
```

**Features:**
- Toolbar (bold, italic, heading, list, link, image)
- Split view (edit | preview)
- Syntax highlighting
- Auto-save (debounced)

### 4.3 Image Gallery
**`ImageGallery`**
```typescript
interface ImageGalleryProps {
  images: Array<{
    url: string
    title?: string
    caption?: string
  }>
  onDelete?: (url: string) => void
  onReorder?: (newOrder: string[]) => void
  editable?: boolean
}
```

**Features:**
- Lightbox au clic
- Drag & drop pour r√©ordonner
- Boutons delete/edit
- Upload de nouvelles images

### 4.4 Status Badge
**`StatusBadge`**
```typescript
type Status = 'DRAFT' | 'GENERATING' | 'READY' | 'FINAL' | 'ARCHIVED'

interface StatusBadgeProps {
  status: Status
  size?: 'sm' | 'md' | 'lg'
}
```

**Couleurs:**
- DRAFT: gris
- GENERATING: bleu (anim√©)
- READY: jaune
- FINAL: vert
- ARCHIVED: gris fonc√©

---

## 5. √âtat & Data Fetching

### React Query hooks

```typescript
// Projets
useProjects(filters?: ProjectFilters)
useProject(id: string)
useCreateProject()
useUpdateProject(id: string)
useDeleteProject(id: string)

// G√©n√©ration
useGenerateMemoire(projectId: string)
useRegenerateSection(sectionId: string)
useGenerationStatus(projectId: string)

// M√©moires r√©f√©rence
useReferenceMemoires(filters?: MemoireFilters)
useUploadMemoire()
useIndexMemoire(id: string)

// Blocs
useContentBlocks(filters?: BlockFilters)
useCreateBlock()
useUpdateBlock(id: string)

// Sections
useSections(projectId: string)
useSection(id: string)
useValidateSection(id: string)

// Export
useExportMemoire(projectId: string, options: ExportOptions)
```

---

## 6. Gestion d'√©tat local

### Context pour l'√©diteur
```typescript
interface EditorContext {
  currentSection: string | null
  setCurrentSection: (id: string) => void
  isDirty: boolean
  setDirty: (dirty: boolean) => void
  autoSave: boolean
  toggleAutoSave: () => void
}
```

---

## 7. Responsive Design

### Breakpoints
- Mobile: < 640px
- Tablet: 640px - 1024px
- Desktop: > 1024px

### Adaptations mobile
- **Dashboard**: Vue liste uniquement
- **√âditeur**: Sidebar collapse en drawer
- **Upload**: Bouton classique (pas de drag & drop)
- **Preview**: Mode plein √©cran

---

## 8. Accessibilit√© (a11y)

### Standards
- Contraste WCAG AA minimum
- Navigation au clavier compl√®te
- Aria labels sur tous les √©l√©ments interactifs
- Skip links
- Focus visible
- Alternatives textuelles pour images

### Tests
- Lighthouse audit (score > 90)
- axe DevTools
- Tests manuels avec lecteur d'√©cran (NVDA/VoiceOver)

---

## 9. Performance

### Optimisations
- **Images**: Next/Image avec lazy loading
- **Code splitting**: Dynamic imports pour pages lourdes
- **Prefetching**: Links vers pages fr√©quentes
- **Caching**: React Query stale time configur√©
- **Bundle size**: < 300KB initial JS

### M√©triques cibles
- LCP: < 2.5s
- FID: < 100ms
- CLS: < 0.1
- TTI: < 3.5s

---

## 10. Gestion d'erreurs

### Error Boundaries
```typescript
<ErrorBoundary
  fallback={<ErrorPage />}
  onError={(error, errorInfo) => logToSentry(error, errorInfo)}
>
  <App />
</ErrorBoundary>
```

### Toast notifications
```typescript
// Succ√®s
toast.success("M√©moire g√©n√©r√© avec succ√®s!")

// Erreur
toast.error("√âchec de l'upload du fichier")

// Info
toast.info("G√©n√©ration en cours...")

// Warning
toast.warning("Certaines sections n√©cessitent validation")
```

---

## 11. Loading States

### Skeletons
- Dashboard: Grille de cartes skeleton
- √âditeur: Blocks de contenu skeleton
- Sidebar: Liste skeleton

### Spinners
- Actions ponctuelles (boutons)
- G√©n√©ration de sections

### Progress bars
- Upload de fichiers
- Indexation de m√©moires
- G√©n√©ration compl√®te

---

## 12. Animations & Transitions

### Framer Motion
```typescript
// Fade in pour les pages
const pageVariants = {
  initial: { opacity: 0, y: 20 },
  animate: { opacity: 1, y: 0 },
  exit: { opacity: 0, y: -20 }
}

// Stagger pour les listes
const listVariants = {
  animate: {
    transition: {
      staggerChildren: 0.1
    }
  }
}
```

### Transitions
- Page transitions: 200ms
- Hover states: 150ms
- Modal open/close: 300ms

---

## 13. Th√®me & Design System

### Palette de couleurs (Bernadet RSE)
```css
:root {
  --primary-green: #78B45A;
  --primary-blue: #2E5090;
  --accent-orange: #FF7043;
  --neutral-gray: #F5F5F5;
  --text-dark: #333333;
  --text-light: #666666;
}
```

### Typographie
- **Headings**: Montserrat (600)
- **Body**: Open Sans (400, 600)
- **Code**: Fira Code

### Espacements
- Base: 4px (0.25rem)
- Scale: 4, 8, 12, 16, 24, 32, 48, 64, 96

---

## 14. Internationalisation (Future)

### Structure
```typescript
// messages/fr.json
{
  "dashboard": {
    "title": "Tableau de bord",
    "create_project": "Cr√©er un projet"
  },
  "projects": {
    "status": {
      "draft": "Brouillon",
      "generating": "En cours",
      "ready": "Pr√™t",
      "final": "Finalis√©"
    }
  }
}
```

### Utilisation
```typescript
import { useTranslation } from 'next-i18next'

const { t } = useTranslation('common')
t('dashboard.title')
```

---

## 15. Tests

### Strat√©gie
- **Unit**: Composants purs (Vitest + Testing Library)
- **Integration**: Flows utilisateur (Playwright)
- **E2E**: Sc√©narios critiques (Playwright)

### Sc√©narios prioritaires
1. Cr√©ation d'un projet complet
2. G√©n√©ration d'un m√©moire
3. R√©g√©n√©ration d'une section
4. Export d'un m√©moire final

### Couverture cible
- Components: > 80%
- Hooks: > 90%
- Utils: > 95%

---

## 16. D√©ploiement

### Environnements
- **Dev**: Vercel preview (branches)
- **Staging**: staging.bernadet-memoires.com
- **Prod**: app.bernadet-memoires.com

### CI/CD (GitHub Actions)
```yaml
1. Lint & Type check
2. Tests (unit + integration)
3. Build
4. Deploy to Vercel
5. Run E2E tests
6. Notify (Slack)
```

---

## 17. Monitoring

### Outils
- **Errors**: Sentry
- **Analytics**: PostHog ou Plausible
- **Performance**: Vercel Analytics
- **Logs**: Logtail

### M√©triques cl√©s
- Taux de succ√®s de g√©n√©ration
- Temps moyen de g√©n√©ration
- Taux d'utilisation des fonctionnalit√©s
- Taux de r√©g√©n√©ration par section

---
